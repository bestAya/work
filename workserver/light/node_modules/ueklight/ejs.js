"use strict";

var os = require("os");
function compile(str) {
    var obj = { name: "zhansgan", age: 12, sex: "man" };
    var reg = new RegExp(os.EOL, "g");

    str = str.replace(/'/, '"').replace(/((?:(?!<script>)[\s\S])*)(?:<script>([\s\S]*)<\/script>)*([\s\S]*)/, function (a, b, c, d) {

        var a = a || "";
        var b = b || "";
        var c = c || "";
        var d = d || "";
        if (os.platform() == "win32") {
            var eol = "\\r\\n";
        } else {
            var eol = "\\n";
        }

        return b.replace(reg, "") + "<script>" + c.replace(reg, "'+'" + eol) + "</script></script>" + d.replace(reg, "");
    });

    str = str.replace(/<%=(((?!%>).)*)%>/g, function (a, b) {
        return "'+" + b + "+'";
    });

    str = str.replace(/<%(((?!%>).)*)%>/g, function (a, b) {
        return "';\n" + b + "\n tpl+=' ";
    });

    str = "'" + str + "'";
    return new Function("obj", "var tpl='';with(obj){ tpl=" + str + "}\n return tpl");
}

function render(str, data) {
    return compile(str)(data);
}

module.exports = render;
//# sourceMappingURL=ejs.js.map